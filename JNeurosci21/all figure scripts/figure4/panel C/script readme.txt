run removepure_diagonal_decoding, the other two functions are support functions